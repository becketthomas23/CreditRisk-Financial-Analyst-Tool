{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Expert Analysis Output",
  "description": "Complete schema for individual guru expert analysis output. All fields are required unless marked optional.",
  "type": "object",
  "required": [
    "expert",
    "signal",
    "confidence",
    "thesis",
    "forward_outlook",
    "analysis",
    "key_risks",
    "what_changes_my_mind",
    "holdings_context",
    "would_buy_at",
    "would_sell_at",
    "private_assessment"
  ],
  "properties": {
    "expert": {
      "type": "string",
      "enum": [
        "warren_buffett",
        "ben_graham",
        "peter_lynch",
        "cathie_wood",
        "george_soros",
        "ray_dalio",
        "michael_burry"
      ],
      "description": "Identifier for the expert guru providing this analysis"
    },
    "signal": {
      "type": "string",
      "enum": ["bullish", "neutral", "bearish"],
      "description": "Overall investment signal based on this guru's framework"
    },
    "confidence": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100,
      "description": "Confidence level in the signal (0-100). Higher = more conviction."
    },
    "thesis": {
      "type": "string",
      "minLength": 100,
      "maxLength": 1000,
      "description": "One paragraph (3-5 sentences) stating the investment thesis. Must be specific about WHY, not just WHAT."
    },
    "forward_outlook": {
      "type": "object",
      "description": "Forward-looking predictions - be bold and specific",
      "required": ["prediction", "timeline", "price_target", "catalyst"],
      "properties": {
        "prediction": {
          "type": "string",
          "description": "Specific prediction about what will happen. Not 'might go up' but 'will reach $X because...'"
        },
        "timeline": {
          "type": "string",
          "description": "When the prediction materializes. E.g., 'by Q4 2026', 'within 18 months', '2-3 years'"
        },
        "price_target": {
          "type": "string",
          "description": "Specific price target or range. E.g., '$280', '$280-320', '50% upside to $300'"
        },
        "catalyst": {
          "type": "string",
          "description": "What specific event or factor triggers the predicted outcome"
        }
      }
    },
    "analysis": {
      "type": "object",
      "description": "Guru-specific analysis sections. Keys vary by guru, but each section has score/max_score/reasoning.",
      "additionalProperties": {
        "type": "object",
        "required": ["score", "max_score", "reasoning"],
        "properties": {
          "score": {
            "type": "number",
            "description": "Score for this criterion"
          },
          "max_score": {
            "type": "number",
            "description": "Maximum possible score for this criterion"
          },
          "reasoning": {
            "type": "string",
            "minLength": 50,
            "description": "Detailed reasoning for the score. Must include specific numbers from the data."
          }
        }
      }
    },
    "key_risks": {
      "type": "array",
      "minItems": 2,
      "maxItems": 5,
      "items": {
        "type": "string",
        "minLength": 20
      },
      "description": "List of key risks identified. Be specific, not generic."
    },
    "what_changes_my_mind": {
      "type": "array",
      "minItems": 1,
      "maxItems": 3,
      "items": {
        "type": "string"
      },
      "description": "Specific conditions that would flip the investment thesis"
    },
    "holdings_context": {
      "type": "object",
      "description": "Context about this guru's actual holdings in this stock (from 13-F data)",
      "required": ["current_position", "recent_changes", "signal_from_actions"],
      "properties": {
        "current_position": {
          "type": "string",
          "description": "Current holdings: 'X shares / $Y value / Z% of portfolio' OR 'No position'"
        },
        "recent_changes": {
          "type": "string",
          "description": "Recent activity: 'Added X%', 'Trimmed Y%', 'New position', 'Exited', 'Unchanged'"
        },
        "signal_from_actions": {
          "type": "string",
          "description": "Interpretation of what the guru's actions signal about conviction"
        }
      }
    },
    "would_buy_at": {
      "type": "string",
      "description": "Price level where this guru would buy aggressively. E.g., '$165', 'Below $170'"
    },
    "would_sell_at": {
      "type": "string",
      "description": "Price level where this guru would start selling. E.g., '$300', 'Above $280'"
    },
    "private_assessment": {
      "type": "string",
      "minLength": 100,
      "description": "The unfiltered truth - what this guru would tell their inner circle but not say on CNBC. Must add insight beyond the thesis."
    }
  },
  "definitions": {
    "buffett_analysis": {
      "description": "Warren Buffett-specific analysis sections",
      "properties": {
        "circle_of_competence": { "$ref": "#/definitions/analysis_section" },
        "moat_analysis": { "$ref": "#/definitions/analysis_section" },
        "management_quality": { "$ref": "#/definitions/analysis_section" },
        "owner_earnings": { "$ref": "#/definitions/analysis_section" },
        "intrinsic_value": { "$ref": "#/definitions/analysis_section" },
        "margin_of_safety": { "$ref": "#/definitions/analysis_section" }
      }
    },
    "graham_analysis": {
      "description": "Ben Graham-specific analysis sections",
      "properties": {
        "mr_market_assessment": { "$ref": "#/definitions/analysis_section" },
        "quantitative_screens": { "$ref": "#/definitions/analysis_section" },
        "net_current_asset_value": { "$ref": "#/definitions/analysis_section" },
        "earnings_power_value": { "$ref": "#/definitions/analysis_section" },
        "margin_of_safety": { "$ref": "#/definitions/analysis_section" },
        "defensive_vs_enterprising": { "$ref": "#/definitions/analysis_section" }
      }
    },
    "lynch_analysis": {
      "description": "Peter Lynch-specific analysis sections",
      "properties": {
        "growth_classification": { "$ref": "#/definitions/analysis_section" },
        "peg_analysis": { "$ref": "#/definitions/analysis_section" },
        "business_story": { "$ref": "#/definitions/analysis_section" },
        "earnings_trajectory": { "$ref": "#/definitions/analysis_section" },
        "institutional_ownership": { "$ref": "#/definitions/analysis_section" }
      }
    },
    "wood_analysis": {
      "description": "Cathie Wood-specific analysis sections",
      "properties": {
        "disruption_assessment": { "$ref": "#/definitions/analysis_section" },
        "tam_analysis": { "$ref": "#/definitions/analysis_section" },
        "innovation_trajectory": { "$ref": "#/definitions/analysis_section" },
        "wright_law_potential": { "$ref": "#/definitions/analysis_section" },
        "five_year_model": { "$ref": "#/definitions/analysis_section" }
      }
    },
    "soros_analysis": {
      "description": "George Soros-specific analysis sections",
      "properties": {
        "reflexivity_analysis": { "$ref": "#/definitions/analysis_section" },
        "boom_bust_stage": { "$ref": "#/definitions/analysis_section" },
        "narrative_momentum": { "$ref": "#/definitions/analysis_section" },
        "macro_positioning": { "$ref": "#/definitions/analysis_section" },
        "sentiment_extreme": { "$ref": "#/definitions/analysis_section" }
      }
    },
    "dalio_analysis": {
      "description": "Ray Dalio-specific analysis sections",
      "properties": {
        "debt_cycle_position": { "$ref": "#/definitions/analysis_section" },
        "historical_template": { "$ref": "#/definitions/analysis_section" },
        "stress_scenarios": { "$ref": "#/definitions/analysis_section" },
        "risk_parity_fit": { "$ref": "#/definitions/analysis_section" },
        "principles_applied": { "$ref": "#/definitions/analysis_section" }
      }
    },
    "burry_analysis": {
      "description": "Michael Burry-specific analysis sections",
      "properties": {
        "revenue_quality": { "$ref": "#/definitions/analysis_section" },
        "earnings_quality": { "$ref": "#/definitions/analysis_section" },
        "balance_sheet_forensics": { "$ref": "#/definitions/analysis_section" },
        "bear_case": { "$ref": "#/definitions/analysis_section" },
        "contrarian_signal": { "$ref": "#/definitions/analysis_section" }
      }
    },
    "analysis_section": {
      "type": "object",
      "required": ["score", "max_score", "reasoning"],
      "properties": {
        "score": { "type": "number" },
        "max_score": { "type": "number" },
        "reasoning": { "type": "string", "minLength": 50 }
      }
    }
  }
}
